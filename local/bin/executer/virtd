#!/usr/bin/env bash

_action() {
  local action && action="$1"
  sudo systemctl "$action" libvirtd.service
  for drv in log lock qemu interface network nodedev nwfilter secret storage; do
    sudo systemctl "$action" virt${drv}d.service
    sudo systemctl "$action" virt${drv}d{,-ro,-admin}.socket
  done
  [[ $action == "start" ]] && virsh net-start default
}

case $1 in
--start | --stop) _action "${1##--}" ;;
*) exit 2 ;;
esac
